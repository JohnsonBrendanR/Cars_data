import csv
import os
from selenium import webdriver
from selenium.webdriver.chrome.service import Service
from selenium.webdriver.common.by import By

# URL of the webpage containing the best selling cars data
url = "https://www.caranddriver.com/news/g39628015/best-selling-cars-2022/"

# Path to Chrome WebDriver
chrome_driver_path = "C:\Program Files (x86)\Google\chromedriver-win64\chromedriver.exe"

# Set up Chrome WebDriver
service = Service(chrome_driver_path)
driver = webdriver.Chrome(service=service)

# Open the webpage
driver.get(url)

# Find all car elements
car_elements = driver.find_elements(By.CSS_SELECTOR, "h2.css-rxobiv.e16kmapv5")

# Initialize a list to store the data
data = []

# Extract data from car elements
for car_element in car_elements:
    text = car_element.text.strip()
    match = text.split('. ')
    rank = int(match[0])
    car, sales_text = match[1].split(' (')
    sales = int(sales_text.split()[0].replace(',', ''))
    data.append((rank, car, sales))

# Sort the data by sales in descending order
data.sort(key=lambda x: x[2], reverse=True)

# Write the sorted data to a CSV file
desktop_path = os.path.join(os.path.expanduser("~"), "Desktop")
csv_file_path = os.path.join(desktop_path, "best_selling_cars_2022_sorted.csv")

with open(csv_file_path, "w", newline="", encoding="utf-8") as csvfile:
    writer = csv.writer(csvfile)
    writer.writerow(["Rank", "Car", "Sales"])
    writer.writerows(data)

# Close the WebDriver
driver.quit()

print(f"Data has been written to: {csv_file_path}")